version: 2.1


setup: true


orbs:
  dynamic: bjd2385/dynamic-continuation@3.4.1
  general: bjd2385/general@dev:16d91f6adefd5a869f6f708398c1cc136a67023d


workflows:
  autoscaler:
    jobs:
      - dynamic/continue:
          context: circleci
          modules: |
            /scripts
            /src
            /tests
            /docker/autoscaler
            /docker/influxdb
            /docker/mysql
            /helm/autoscaler
            /helm/influxdb
            /helm/mysql
            /conf

      - general/github-release:
          name: Create GitHub release from tag
          context: github
          filters:
            branches:
              ignore: /.*/
            tags:
              only: /^v?[0-9]+\.[0-9]+\.[0-9]+$/

      - general/python-release-twine:
          name: pypi autoscaler upload [python]
          context: nexus
          repository: python
          filters:
            branches:
              ignore: /.*/
            tags:
              only: /^v?[0-9]+\.[0-9]+\.[0-9]+$/

      - general/helm-release-nexus:
          name: helm build and push [helm/autoscaler]
          context: nexus
          path: helm/autoscaler
          repo-name: premiscale
          filters:
            branches:
              ignore: /.*/
            tags:
              only: /^v?[0-9]+\.[0-9]+\.[0-9]+$/
